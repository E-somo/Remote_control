<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background-color: #15b337;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .main-container {
            background-color: #15b337;
            width: 65%;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
        }

        .styled-button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            height: fit-content;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .styled-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h2 style="text-align:center;">
    <h2><big>SBMA</big> <br> <br>Students/staff Behavior Monitoring AI Agent <br> <br>
Remote SMS Customization
Dashboard 
</h2>
        <div class="button-container">
            <button class="styled-button" onclick="showVideoAlert() "> How to use Remote SMS <br><br>Customization Dashboard</button>
            <button class="styled-button" onclick="showImageAlert()">Remotely Add/Edit  <br> <br> contacts For Group Message</button>
            <button class="styled-button" onclick="showGoogleSheetAlert()"> Remotely customize   <br> <br>Indidualized Bulky SMS  </button>
        </div>
    </div>


    <script>
    var field1 = "not";
    var field2 = "not";
    var field3 = "not";
    var fieldSerch="get";
    
function showImageAlert() {
    Swal.fire({
        title: 'Suitable for Group Message',
        html: `
            <p>
                To send a common message to all your prepared and updated group, send a normal SMS to your updated server with the following command:<br>
                <br>
                <b>CMD7bulk:</b> followed by the message to send.<br>
                Example: CMDbulk: dear Parent/staff, The meeting is shifted to Tuesday 9:00. Thanks.<br>
                <br>
                <b>N.B:</b> The total message characters should <b>not exceed 160.</b><br>
                <br>
                If you  want to see the sample google sheet contact, click <a href="javascript:void(0);" onclick="showSamplePicture()">here</a> <br> <br>To login to your contact , set up  or updating contact <b>click Ok.<br>
            </p>`,
        confirmButtonText: 'OK',
        didClose: () => {
            openForm();
        }
    });
}

function showSamplePicture() {
    Swal.fire({
        text: 'N.B Remember, in Column B, input full names, and in Column C, provide the corresponding contact phone numbers. Failure to adhere to this format may result in the functionality not working correctly.',
        imageUrl: 'https://raw.githubusercontent.com/E-somo/Remote_control/main/contactsview.PNG',
        imageAlt: 'Sample Picture',
        confirmButtonText: 'OK'
    });
}


function showVideoAlert() {
    // Create a custom HTML element for the video
    const videoElement = document.createElement("div");
    videoElement.innerHTML = `
        <video width="560" height="315" controls>
            <source src="https://github.com/E-somo/downloads/raw/main/New%20creative%20video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <p>Text below the video</p>
    `;

    // Show the Swal modal with the custom HTML
    Swal.fire({
        title: 'Video Alert',
        html: videoElement,
        confirmButtonText: 'OK',
        showCloseButton: true, // Optionally show a close button
    });
}

        function showGoogleSheetAlert() {
            Swal.fire({
                title: 'Google Sheet Alert',
                html: '<p>Click the button below to open the Google Sheet:</p>' +
                      '<a href="https://docs.google.com/spreadsheets/d/your-sheet-id/edit" target="_blank">' +
                      '<button>Open Google Sheet</button></a>',
                confirmButtonText: 'Close',
            });
        } 
        
        
         function openForm() {
            Swal.fire({
                title: 'Enter Your SBMA Credentials',
                html:
                    '<input id="field1" class="swal2-input" placeholder="Server Id ">' +
                      '<input id="field2" type="password" class="swal2-input" placeholder="Enter Server Pin">' +
     
                    '<input id="field3" class="swal2-input" placeholder="Enter Phone Of Authorized person">',
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Submit',
                preConfirm: () => {
                     field1 = Swal.getPopup().querySelector('#field1').value;
                     field2 = Swal.getPopup().querySelector('#field2').value;
                     field3 = Swal.getPopup().querySelector('#field3').value;

                    if (field2*1 === field1 * 2) {
                        //reportTask(field1, field2, field3); 
                        fieldSerch = field1 + "" + field2 + "" + field3;
                        
                        checkUpdate();
                        
                    } else {
                        Swal.showValidationMessage('Field 2 must be equal to Field 1 times 2!');
                        return false;
                    }
                }
            });
        }

      
       function reportTask(field1, field2, field3) {
            fetch('https://docs.google.com/forms/d/1Cz3dA8Vf12ssSuup6k3LkpnucxvxA45YXsOWN6w2AF8/formResponse', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'entry.1204219384=' + encodeURIComponent(field1) +
                        '&entry.1167664038=' + encodeURIComponent(field2) +
                        '&entry.1234567890=' + encodeURIComponent(field3),
            })
            .then(response => {
                console.log(response);
                Swal.fire({
                    icon: 'success',
                    title: 'Data Submitted Successfully!',
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
       
      function checkUpdate() {
    const base = "https://docs.google.com/spreadsheets/d/1EnupAXodLDy6cgg35YnPDTneqRwBkDI8gGoju7u3sYw/gviz/tq?gid=1635324984";
    const query = "Select B, C, D";
    const url = base + "&tq=" + encodeURIComponent(query);

    fetch(url)
        .then(response => response.text())
        .then(data => {
            const jsonResponse = JSON.parse(data.match(/(?<=\()[\s\S]*(?=\);)/)[0]);
            handleResponse(jsonResponse);
        })
        .catch(error => {
            console.error(error);
            displayResult("Error fetching data");
        });
}

function handleResponse(response) {
    if (response.status === "ok") {
        const rows = response.table.rows;
        const columnBValues = rows.map(row => row.c[0] ? row.c[0].v : null);

       // const targetValue = "examplexxcField";
                  const targetValue =fieldSerch;
        const rowIndex = columnBValues.findIndex(value => value && value.includes(targetValue));

        if (rowIndex !== -1) {
            const rowData = rows[rowIndex].c.map(cell => cell ? cell.v : null);
            const alertMessage = `${rows[rowIndex].c[0].v}`;
			alert(alertMessage);

            // Extract sheet ID and GID from the alertMessage
            const pattern = /\/spreadsheets\/d\/(.*?)\/edit#gid=(\d+)/;
			
			const pattern2 = /\?resourcekey#/;
const modifiedMessage = alertMessage.replace(pattern2, '#');
const match = modifiedMessage.match(pattern);
			
			
           
            const sheetId = match && match[1] ? match[1] : null;
            const gid = match && match[2] ? match[2] : null;

            if (sheetId !== null && gid !== null) {
                const fullSheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/edit#gid=${gid}`;
                console.log("Full Google Sheet URL: " + fullSheetUrl);

     Swal.fire({
    title: 'Google Sheet URL',
    html: `Your retrieved link is:<br><br>${fullSheetUrl}<br><br>Please click on the button below to see the details of your data.`,
    showCancelButton: true,
    confirmButtonText: 'Open Sheet',
    cancelButtonText: 'Close',
}).then((result) => {
    if (result.isConfirmed) {
        window.open(fullSheetUrl, '_blank');
    }
});

            } else {
              Swal.fire({
    icon: 'error',
    title: 'Invalid Google Sheet URL',
    text: 'You have submitted an incorrect Google Sheet URL. Please resubmit the correct URL and try again. If the error persists, please contact your service provider..',
}).then((result) => {
    if (result.isConfirmed) {
        // Handle the case where the Google Sheet URL is invalid
    } else {
        // Handle the case where the user cancels or closes the alert
    }
}).then(() => {
    Swal.fire({
        title: 'Add Contact Link',
        text: "You don't have a link to your contact. Please add it below:",
        input: 'text',
        showCancelButton: true,
        confirmButtonText: 'Submit',
        cancelButtonText: 'Cancel',
    }).then((result) => {
        if (result.isConfirmed && result.value) {
            const contactLink = result.value;

            const fieldcore = fieldSerch + "" + contactLink;
            reportTask(fieldcore, field2, field3);
        } else {
            // Handle the case where the user cancels or closes the alert
        }
    });
});
        }
        } else {
            alert(`Column B does not contain '${targetValue}'`);
            // Replace the following lines with the actual values or logic
             
            
			Swal.fire({
    title: 'Add Contact Link',
    text: "You don't have a link to your contact. Please add it below:",
    input: 'text',
    showCancelButton: true,
    confirmButtonText: 'Submit',
    cancelButtonText: 'Cancel',
}).then((result) => {
    if (result.isConfirmed && result.value) {
        const contactLink = result.value;

        // You can replace these fields with your actual values or logic
        
         const fieldcore = fieldSerch+ "" + contactLink;
         reportTask(fieldcore, field2, field3);
         
 Swal.fire({
    position: 'top-end',
    icon: 'success',
    title: 'Your work has been saved',
    showConfirmButton: false,
    timer: 1500,
    timerProgressBar: true,
    didClose: () => {
        // Callback function to be executed when the timer completes
        checkUpdate();
    }
});



    }
});	
			
        }
    } else {
        // displayResult("Error in response");
    }
}

          
    </script>

</body>
</html>
